<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>OCR Pro AI | Mohit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        body { background-color: #020617; background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,0.2) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,0.2) 0, transparent 50%); font-family: 'Plus Jakarta Sans', sans-serif; color: #f1f5f9; min-height: 100vh; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .log-container { font-family: 'JetBrains Mono', monospace; scrollbar-width: thin; scrollbar-color: #334155 transparent; }
        .btn-primary { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.5); }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row items-center justify-between mb-10 gap-6">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <i data-lucide="cpu" class="text-white w-7 h-7"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tight text-white">OCR <span class="text-indigo-400">Cleaner</span> Pro</h1>
                    <p class="text-slate-400 text-sm font-medium uppercase tracking-wider">Engineered by Mohit</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button id="startBtn" class="btn-primary flex items-center gap-2 px-8 py-3 rounded-xl font-bold text-white shadow-xl">
                    <i data-lucide="zap" class="w-5 h-5"></i> START ENGINE
                </button>
                <button id="stopBtn" disabled class="bg-slate-800 hover:bg-rose-600 text-slate-400 hover:text-white transition-all px-6 py-3 rounded-xl font-bold disabled:opacity-20 disabled:cursor-not-allowed">
                    <i data-lucide="octagon" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass p-6 rounded-3xl">
                    <h3 class="text-white font-bold mb-6 flex items-center gap-2"><i data-lucide="sliders" class="w-5 h-5 text-indigo-400"></i> Parameters</h3>
                    <div class="space-y-5">
                        <label class="text-xs font-bold text-slate-500 uppercase block ml-1">Input Text File</label>
                        <input id="fileInput" type="file" accept=".txt" class="block w-full text-sm text-slate-400 bg-slate-900/50 rounded-xl p-2 border border-slate-800 cursor-pointer"/>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase mb-2 block ml-1">Qs per Chunk</label>
                                <input id="qsPerChunk" type="number" value="15" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl px-4 py-3 text-indigo-100 font-mono"/>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase mb-2 block ml-1">Delay (ms)</label>
                                <input id="delay" type="number" value="1200" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl px-4 py-3 text-indigo-100 font-mono"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="glass p-5 rounded-3xl text-center"><div id="statTotal" class="text-3xl font-black text-white">-</div><div class="text-[10px] font-bold text-slate-500 uppercase">Total Chunks</div></div>
                    <div class="glass p-5 rounded-3xl text-center border-emerald-500/20"><div id="statDone" class="text-3xl font-black text-emerald-400">0</div><div class="text-[10px] font-bold text-slate-500 uppercase">Processed</div></div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div class="glass py-4 px-6 rounded-2xl flex items-center justify-between">
                    <div class="w-full bg-slate-800 rounded-full h-3 overflow-hidden mr-4">
                        <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-cyan-400 h-full w-0 transition-all duration-700"></div>
                    </div>
                    <span id="progressText" class="text-sm font-bold text-indigo-300">0%</span>
                </div>
                <div class="glass rounded-3xl overflow-hidden flex flex-col">
                    <div class="bg-slate-900/80 px-6 py-4 border-b border-white/5 flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase">Live Terminal</span>
                        <a id="downloadLink" class="hidden text-xs font-bold bg-emerald-500 text-slate-950 px-4 py-1.5 rounded-full shadow-lg">SAVE OUTPUT</a>
                    </div>
                    <div id="log" class="log-container h-[50vh] p-6 text-sm overflow-y-auto bg-[#020617]/80"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://js.puter.com/v2/"></script>
    <script>
        lucide.createIcons();
        (function(){
            const fileInput = document.getElementById("fileInput"), startBtn = document.getElementById("startBtn"), stopBtn = document.getElementById("stopBtn"), logBox = document.getElementById("log"), downloadLink = document.getElementById("downloadLink"), progressBar = document.getElementById("progressBar"), progressText = document.getElementById("progressText"), statTotal = document.getElementById("statTotal"), statDone = document.getElementById("statDone");
            let stopFlag = false, correctedChunks = [];

            function log(t, type="info"){
                const line = document.createElement('div');
                line.className = "mb-4 pb-4 border-b border-white/5 " + (type==='ai'?'text-cyan-400':'text-indigo-300');
                line.innerHTML = `<div class="whitespace-pre-wrap">${t}</div>`;
                logBox.appendChild(line); logBox.scrollTop = logBox.scrollHeight;
            }

            function splitIntoQuestions(text, qsPerChunk) {
                // Split correctly at Q.No: markers
                const parts = text.split(/(?=Q\.No\s*:)/gi);
                const header = parts[0]; 
                const questions = parts.slice(1);
                
                let chunks = [];
                for (let i = 0; i < questions.length; i += qsPerChunk) {
                    let content = questions.slice(i, i + qsPerChunk).join("\n\n");
                    // Always prepend header to the first chunk or if it contains keywords
                    if (i === 0 || header.includes("Exam Level")) content = header + "\n" + content;
                    chunks.push(content);
                }
                return chunks;
            }

            async function sendToAI(content){
                const prompt = `
You are a COMPETITIVE EXAM ANSWERING ENGINE.

ABSOLUTE RULES (NO VIOLATION):
1. Fix OCR errors in English (broken words, merged lines, garbage symbols).
2. Answer every question with the help of options .
3. Extract exam metadata ONLY if explicitly present:
   - Exam Level
   - Test Date
   - Shift
4. Construct exam tag ONLY from extracted data:
   Example: SSC CGL Tier 1 14 Sep 2025 (Shift-3)
5. Keep written exam tags at its location 
6. If a question has options and the correct answer is CLEAR and STANDARD, pick it and convert to:
   • Question – Correct Answer (Exam Date)
   Then REMOVE all options.
8. If the correct answer cannot directly answered by question it requires options or statement then:
   • Keep MCQ format (exam date)
   • Keep all options
   • Write: correct answer 
9. Statement / assertion-reason questions MUST remain MCQ.
10. Do NOT write explanations.
11. Remove non-content text (roll number, candidate name, footers, channel names).
12. Merge broken lines to reconstruct full questions.
13. Each new question must start with the same question number as mentioned 
14. Preserve English technical terms exactly (Shift, Tier, NTPC, etc.).
15. I want content in english only remove hindi but you use hindi for correction in english if any



TEXT: ${content}`;
                try {
                    let r = await puter.ai.chat(prompt, { model:"deepseek/deepseek-v3.2", max_tokens:3000 });
                    return r.message.content;
                } catch(e) { return "AI_ERROR"; }
            }

            startBtn.onclick = async ()=>{
                const file = fileInput.files[0]; if(!file) return;
                startBtn.disabled = true; stopBtn.disabled = false; stopFlag = false; correctedChunks = []; logBox.innerHTML = "";
                
                const text = await file.text();
                const qCount = parseInt(document.getElementById("qsPerChunk").value) || 15;
                const chunks = splitIntoQuestions(text, qCount);
                statTotal.textContent = chunks.length;

                for(let i=0; i<chunks.length; i++){
                    if(stopFlag) break;
                    log(`Processing Chunk ${i+1}/${chunks.length}...`);
                    let output = await sendToAI(chunks[i]);
                    if(output === "AI_ERROR") {
                        log("Retrying chunk...", "error");
                        await new Promise(r=>setTimeout(r, 2000));
                        output = await sendToAI(chunks[i]);
                    }
                    log(output, "ai");
                    correctedChunks.push(output);
                    statDone.textContent = i + 1;
                    let p = Math.round(((i+1)/chunks.length)*100);
                    progressBar.style.width = p+"%"; progressText.textContent = p+"%";
                    await new Promise(r=>setTimeout(r, document.getElementById("delay").value));
                }

                const blob = new Blob([correctedChunks.join("\n\n")], {type:"text/plain"});
                downloadLink.href = URL.createObjectURL(blob);
                downloadLink.download = "Cleaned_Exam_Paper.txt";
                downloadLink.classList.remove('hidden');
                downloadLink.click();
                startBtn.disabled = false; stopBtn.disabled = true;
            };
            stopBtn.onclick = () => stopFlag = true;
        })();
    </script>
</body>
</html>
